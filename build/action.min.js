(function(f){f.action=new function(){var a=this,e=Date.now(),d=0,b,c,g,h,f,k,m,r,l=[],n=24,p;this.__defineGetter__("pageLoadTime",function(){return d});this.createLog=function(a,c){a=a||300;c=c||!1;b=document.createElement("div");b.style.position="absolute";c?(b.style.bottom="0px",b.style.left="0px",b.style.width="100%",b.style.height=String(a)+"px"):(b.style.top="0px",b.style.right="0px",b.style.width=String(a)+"px",b.style.height="100%");b.style.backgroundColor="#CCCCCC";b.style.fontFamily="Consolas, monaco, monospace";
b.style.fontSize="14px";b.style.overflowX="auto";b.style.overflowY="scroll";b.innerHTML="Action.JS Output<br><br>";document.body.appendChild(b)};this.createStage=function(e,b,d,l,n,p){h=e||0;f=b||0;k=d||800;m=l||600;r=n||"#FFFFFF";c=document.createElement("canvas");c.width=k;c.height=m;c.style.position="absolute";c.style.top=String(f)+"px";c.style.left=String(h)+"px";c.style.border=p||"1px solid #000000";g=c.getContext("2d");a.clearStage();document.body.appendChild(c)};this.setLog=function(a){b=document.getElementById(a);
b.style.fontFamily="Consolas, monaco, monospace";b.style.fontSize="14px";b.innerHTML="Action.JS Output<br><br>"};this.setStage=function(e,b){c=document.getElementById(e);h=a.util.elementPosition(c).left;f=a.util.elementPosition(c).top;k=c.width;m=c.height;g=c.getContext("2d");r=b||"#FFFFFF";a.clearStage()};this.__defineGetter__("canvas",function(){return c});this.__defineGetter__("stage",function(){return g});this.__defineGetter__("stageX",function(){return h});this.__defineGetter__("stageY",function(){return f});
this.__defineGetter__("stageWidth",function(){return k});this.__defineGetter__("stageHeight",function(){return m});this.__defineGetter__("numDisplayed",function(){return l.length});this.__defineGetter__("fps",function(){return n});this.__defineSetter__("fps",function(a){clearInterval(p);n=a;s()});var t=setInterval(function(){"complete"===document.readyState&&(d=Date.now()-e,a.main?a.main():console.log("Action.JS Warning: no function action.main() found"),clearInterval(t))},10),s=function(){p=setInterval(function(){a.dispatchEvent(a.events.ENTER_FRAME);
a.clearStage();a.drawAll()},Math.ceil(1E3/n))};this.kill=function(){clearInterval(p)};this.log=function(a){b.innerHTML+=">"+String(a)+"<br>";b.scrollTop=b.scrollHeight};this.title=function(a){document.title=a};this.clearStage=function(){g.fillStyle=r;g.fillRect(0,0,k,m)};this.drawAll=function(){for(var a=0;a<l.length;a++)l[a].draw(g)};this.display=function(c){a.undisplay(c);l.push(c);c.displayed=!0};this.undisplay=function(a){for(var c=0;c<l.length;c++)if(l[c]===a){l.splice(c,1);a.displayed=!1;break}}}})(window);
(function(f,a){a.calc={};a.calc.DEG2RAD=Math.PI/180;a.calc.RAD2DEG=180/Math.PI;a.calc.inRange=function(a,d,b){return d<=a&&a<=b};a.calc.distance=function(a,d,b,c){a=b-a;d=c-d;return Math.sqrt(a*a+d*d)};a.calc.rotate=function(a,d,b,c,g){var h=Math.sin(g);g=Math.cos(g);a-=b;d-=c;return{x:a*g-d*h+b,y:a*h+d*g+c}};a.calc.boundingBox=function(e){if(0===e.rotation%360)return{x:e.x-e.center.x*e.scaleX,y:e.y-e.center.y*e.scaleY,width:e.width*e.scaleX,height:e.height*e.scaleY};for(var d=[{x:0,y:0},{x:e.width*
e.scaleX,y:0},{x:e.width*e.scaleX,y:e.height*e.scaleY},{x:0,y:e.height*e.scaleY}],b=[],c,g=0;4>g;g++)c=d[g],b.push(a.calc.rotate(c.x,c.y,e.center.x,e.center.y,e.rotation*a.calc.DEG2RAD));for(var d=b[0].x,h=b[0].y,f=b[2].x,k=b[2].y,g=0;4>g;g++)c=b[g],c.x<d&&(d=c.x),c.x>f&&(f=c.x),c.y<h&&(h=c.y),c.y>k&&(k=c.y);b=e.x-e.center.x*e.scaleX;e=e.y-e.center.y*e.scaleY;d+=b;h+=e;return{x:d,y:h,width:f+b-d,height:k+e-h}};a.calc.ptCollisionRect=function(e,d,b){return b.displayed?(b=a.calc.boundingBox(b),a.calc.inRange(e,
b.x,b.x+b.width)&&a.calc.inRange(d,b.y,b.y+b.height)):!1};a.calc.ptCollisionCirc=function(e,d,b){if(b.displayed){b=a.calc.boundingBox(b);var c=b.width>b.height?b.width:b.height;return a.calc.distance(e,d,b.x+b.width/2,b.y+b.height/2)<=c}return!1};a.calc.collisionRect=function(e,d){if(e.displayed&&d.displayed){var b=a.calc.boundingBox(e),c=a.calc.boundingBox(d);return(a.calc.inRange(b.x,c.x,c.x+c.width)||a.calc.inRange(b.x+b.width,c.x,c.x+c.width))&&(a.calc.inRange(b.y,c.y,c.y+c.height)||a.calc.inRange(b.y+
b.height,c.y,c.y+c.height))}return!1};a.calc.collisionCirc=function(e,d){if(e.displayed&&d.displayed){var b=a.calc.boundingBox(e),c=a.calc.boundingBox(d),g=b.width>b.height?b.width:b.height,f=c.width>c.height?c.width:c.height;return a.calc.distance(b.x+b.width/2,b.y+b.height/2,c.x+c.width/2,c.y+c.height/2)<=g+f}return!1}})(window,action);
(function(f,a){a.util={};a.util.addEventHandler=function(a,d,b){a.addEventListener?a.addEventListener(d,b):a.attachEvent&&a.attachEvent("on"+d,b)};a.util.removeEventHandler=function(a,d,b){a.removeEventListener?a.removeEventListener(d,b):a.detachEvent&&a.detachEvent("on"+d,b)};a.util.elementPosition=function(a){var d=0,b=0;if(a.offsetParent){do d+=a.offsetLeft,b+=a.offsetTop;while(a=a.offsetParent)}return{left:d,top:b}};a.util.browser=function(){var a=navigator.appName,d=navigator.userAgent,b,c=d.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
c&&null!=(b=d.match(/version\/([\.\d]+)/i))&&(c[2]=b[1]);c=c?[c[1],c[2]]:[a,navigator.appVersion,"-?"];return{name:c[0].toLowerCase(),version:c[1]}}();a.util.browser.os=function(){var a=navigator.platform.toLowerCase();return-1!=a.indexOf("win")?"windows":-1!=a.indexOf("mac")?"mac":-1!=a.indexOf("iphone")||-1!=a.indexOf("ipod")||-1!=a.indexOf("ipad")?"iOS":-1!=a.indexOf("linux")?"linux":"unknown"}();a.util.browser.hasJava=navigator.javaEnabled();a.util.browser.agent=navigator.userAgent})(window,action);
(function(f,a){a.events={};a.events.READY="ready";a.events.LOAD="load";a.events.ENTER_FRAME="enterframe";a.events.CLICK="click";a.events.MOUSE_MOVE="mousemove";a.events.MOUSE_DOWN="mousedown";a.events.MOUSE_UP="mouseup";a.events.MOUSE_WHEEL="mouse_wheel";a.events.KEY_DOWN="keydown";a.events.KEY_UP="keyup";a.events.click=function(e,d){a.addEventListener(a.events.CLICK,function(){a.calc.ptCollisionRect(a.mouse.x,a.mouse.y,e)&&d(e)})};a.events.hover=function(e,d){a.addEventListener(a.events.MOUSE_MOVE,
function(){a.calc.ptCollisionRect(a.mouse.x,a.mouse.y,e)&&d(e)})};a.addEventListener=function(e,d){a.util.addEventHandler(f,e,d)};a.removeEventListener=function(e,d){a.util.removeEventHandler(f,e,d)};a.dispatchEvent=function(a,d){d=d||{};f.dispatchEvent(new CustomEvent(a,{detail:d}))};a.addEventListener("firefox"===a.util.browser.name?"DOMMouseScroll":"mousewheel",function(e){a.dispatchEvent(a.events.MOUSE_WHEEL,{delta:e.detail?-1*e.detail:e.wheelDelta/120})})})(window,action);
(function(f,a){a.mouse={};a.mouse.x=0;a.mouse.y=0;a.addEventListener(a.events.MOUSE_MOVE,function(e){a.mouse.x=e.pageX-a.stageX;a.mouse.y=e.pageY-a.stageY});a.keyboard={};a.keyboard.ENTER=13;a.keyboard.SPACEBAR=32;a.keyboard.LEFT=37;a.keyboard.UP=38;a.keyboard.RIGHT=39;a.keyboard.DOWN=40;a.keyboard.A=65;a.keyboard.B=66;a.keyboard.C=67;a.keyboard.D=68;a.keyboard.E=69;a.keyboard.F=70;a.keyboard.G=71;a.keyboard.H=72;a.keyboard.I=73;a.keyboard.J=74;a.keyboard.K=75;a.keyboard.L=76;a.keyboard.M=77;a.keyboard.N=
78;a.keyboard.O=79;a.keyboard.P=80;a.keyboard.Q=81;a.keyboard.R=82;a.keyboard.S=83;a.keyboard.T=84;a.keyboard.U=85;a.keyboard.V=86;a.keyboard.W=87;a.keyboard.X=88;a.keyboard.Y=89;a.keyboard.Z=90})(window,action);
(function(f,a){a.Text=function(e,d,b){var c=this;this.displayed=!1;this.y=this.x=0;this.center={x:0,y:0};this.rotation=0;this.font=e||"16pt Arial";this.text=d||"";this.fill=b||"#000000";this.__defineGetter__("width",function(){a.stage.font=c.font;return a.stage.measureText(c.text).width});this.draw=function(b){b.save();b.translate(c.x,c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.fillStyle=c.fill;b.font=c.font;b.fillText(c.text,-c.center.x,-c.center.y);b.restore()}}})(window,action);
(function(f,a){a.Rectangle=function(e,d,b){var c=this;this.displayed=!1;this.y=this.x=0;this.width=e;this.height=d;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;this.fill=b||"#000000";this.draw=function(b){b.save();b.fillStyle=c.fill;b.translate(c.x,c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.fillRect(-c.center.x*c.scaleX,-c.center.y*c.scaleY,c.width*c.scaleX,c.height*c.scaleY);b.restore()}}})(window,action);
(function(f,a){a.Image=function(e){var d=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var b=new Image;a.util.addEventHandler(b,"load",function(){d.width=b.width;d.height=b.height});b.src=e;this.draw=function(c){c.save();c.translate(d.x,d.y);c.rotate(d.rotation*a.calc.DEG2RAD);c.drawImage(b,-d.center.x*d.scaleX,-d.center.y*d.scaleY,d.width*d.scaleX,d.height*d.scaleY);c.restore()}}})(window,action);
(function(f,a){a.Animation=function(e,d,b){var c=this;this.displayed=!1;this.y=this.x=0;this.width=d;this.height=b;this.center={x:0,y:0};this.scaleY=this.scaleX=1;var g=this.rotation=0,f=0,q=new Image;a.util.addEventHandler(q,"load",function(){g=Math.round(q.width/c.width)});q.src=e;a.addEventListener(a.events.ENTER_FRAME,function(){f++;f%=g});this.draw=function(b){b.save();b.translate(c.x,c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.drawImage(q,f*c.width,0,c.width,c.height,-c.center.x*c.scaleX,-c.center.y*
c.scaleY,c.width*c.scaleX,c.height*c.scaleY);b.restore()}}})(window,action);
(function(f,a){a.Sprite=function(){var a=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var d={},b;this.addState=function(a,b){d[a]=b};this.removeState=function(a){delete d[a]};this.show=function(c){b=d[c];a.width=b.width;a.height=b.height};this.draw=function(c){b.x=a.x;b.y=a.y;b.center=a.center;b.scaleX=a.scaleX;b.scaleY=a.scaleY;b.rotation=a.rotation;b.draw(c)}}})(window,action);
