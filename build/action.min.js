(function(k){k.action=new function(){var d=this,a=Date.now(),e=0,c,b,g,f,l,h,k,n,m=[],p=24,q;this.__defineGetter__("pageLoadTime",function(){return e});this.createLog=function(b,a){b=b||300;a=a||!1;c=document.createElement("div");c.style.position="absolute";a?(c.style.bottom="0px",c.style.left="0px",c.style.width="100%",c.style.height=String(b)+"px"):(c.style.top="0px",c.style.right="0px",c.style.width=String(b)+"px",c.style.height="100%");c.style.backgroundColor="#CCCCCC";c.style.fontFamily="Consolas, monaco, monospace";
c.style.fontSize="14px";c.style.overflowX="auto";c.style.overflowY="scroll";c.innerHTML="Action.JS Output<br><br>";document.body.appendChild(c)};this.createStage=function(c,a,e,p,m,q){f=c||0;l=a||0;h=e||800;k=p||600;n=m||"#FFFFFF";b=document.createElement("canvas");b.width=h;b.height=k;b.style.position="absolute";b.style.top=String(l)+"px";b.style.left=String(f)+"px";b.style.border=q||"1px solid #000000";g=b.getContext("2d");d.clearStage();document.body.appendChild(b)};this.setLog=function(b){c=document.getElementById(b);
c.style.fontFamily="Consolas, monaco, monospace";c.style.fontSize="14px";c.innerHTML="Action.JS Output<br><br>"};this.setStage=function(c,a){b=document.getElementById(c);f=d.util.elementPosition(b).left;l=d.util.elementPosition(b).top;h=b.width;k=b.height;g=b.getContext("2d");n=a||"#FFFFFF";d.clearStage()};this.__defineGetter__("canvas",function(){return b});this.__defineGetter__("stage",function(){return g});this.__defineGetter__("stageX",function(){return f});this.__defineGetter__("stageY",function(){return l});
this.__defineGetter__("stageWidth",function(){return h});this.__defineGetter__("stageHeight",function(){return k});this.__defineGetter__("numDisplayed",function(){return m.length});this.__defineGetter__("fps",function(){return p});this.__defineSetter__("fps",function(b){clearInterval(q);p=b;r()});var s=setInterval(function(){"complete"===document.readyState&&(e=Date.now()-a,d.main?d.main():console.log("Action.JS Warning: no function action.main() found"),clearInterval(s))},10),r=function(){q=setInterval(function(){d.dispatchEvent(d.events.ENTER_FRAME);
d.clearStage();d.drawAll()},Math.ceil(1E3/p))};this.kill=function(){clearInterval(q)};this.log=function(b){c.innerHTML+=">"+String(b)+"<br>";c.scrollTop=c.scrollHeight};this.title=function(b){document.title=b};this.clearStage=function(){g.fillStyle=n;g.fillRect(0,0,h,k)};this.drawAll=function(){for(var b=0;b<m.length;b++)m[b].draw(g)};this.display=function(b){d.undisplay(b);m.push(b);b.displayed=!0};this.undisplay=function(b){for(var c=0;c<m.length;c++)if(m[c]===b){m.splice(c,1);b.displayed=!1;break}};
this.emptyDisplay=function(){m=[]}}})(window);
(function(k,d){d.calc={};d.calc.DEG2RAD=Math.PI/180;d.calc.RAD2DEG=180/Math.PI;d.calc.inRange=function(a,d,c){return d<=a&&a<=c};d.calc.distance=function(a,d,c,b){a=c-a;d=b-d;return Math.sqrt(a*a+d*d)};d.calc.rotate=function(a,d,c,b,g){var f=Math.sin(g);g=Math.cos(g);a-=c;d-=b;return{x:a*g-d*f+c,y:a*f+d*g+b}};d.calc.boundingBox=function(a){if(0===a.rotation%360)return{x:a.x-a.center.x*a.scaleX,y:a.y-a.center.y*a.scaleY,width:a.width*a.scaleX,height:a.height*a.scaleY};for(var e=[{x:0,y:0},{x:a.width*
a.scaleX,y:0},{x:a.width*a.scaleX,y:a.height*a.scaleY},{x:0,y:a.height*a.scaleY}],c=[],b,g=0;4>g;g++)b=e[g],c.push(d.calc.rotate(b.x,b.y,a.center.x,a.center.y,a.rotation*d.calc.DEG2RAD));for(var e=c[0].x,f=c[0].y,l=c[2].x,h=c[2].y,g=0;4>g;g++)b=c[g],b.x<e&&(e=b.x),b.x>l&&(l=b.x),b.y<f&&(f=b.y),b.y>h&&(h=b.y);c=a.x-a.center.x*a.scaleX;a=a.y-a.center.y*a.scaleY;e+=c;f+=a;return{x:e,y:f,width:l+c-e,height:h+a-f}};d.calc.ptCollisionRect=function(a,e,c){return c.displayed?(c=d.calc.boundingBox(c),d.calc.inRange(a,
c.x,c.x+c.width)&&d.calc.inRange(e,c.y,c.y+c.height)):!1};d.calc.ptCollisionCirc=function(a,e,c){if(c.displayed){c=d.calc.boundingBox(c);var b=c.width>c.height?c.width:c.height;return d.calc.distance(a,e,c.x+c.width/2,c.y+c.height/2)<=b}return!1};d.calc.collisionRect=function(a,e){if(a.displayed&&e.displayed){var c=d.calc.boundingBox(a),b=d.calc.boundingBox(e);return(d.calc.inRange(c.x,b.x,b.x+b.width)||d.calc.inRange(b.x,c.x,c.x+c.width))&&(d.calc.inRange(c.y,b.y,b.y+b.height)||d.calc.inRange(b.y,
c.y,c.y+c.height))}return!1};d.calc.collisionCirc=function(a,e){if(a.displayed&&e.displayed){var c=d.calc.boundingBox(a),b=d.calc.boundingBox(e),g=c.width>c.height?c.width:c.height,f=b.width>b.height?b.width:b.height;return d.calc.distance(c.x+c.width/2,c.y+c.height/2,b.x+b.width/2,b.y+b.height/2)<=g+f}return!1}})(window,action);
(function(k,d,a){a.util={};a.util.addEventHandler=function(a,c,b){a.addEventListener?a.addEventListener(c,b):a.attachEvent&&a.attachEvent("on"+c,b)};a.util.removeEventHandler=function(a,c,b){a.removeEventListener?a.removeEventListener(c,b):a.detachEvent&&a.detachEvent("on"+c,b)};a.util.include=function(e,c,b){function g(){l||h.readyState&&"complete"!==h.readyState||(l=!0,c(),a.util.removeEventHandler(h,"load",g),a.util.removeEventHandler(h,"readystatechange",g))}b=b||!1;c=c||function(){};var f=d.getElementsByTagName("script"),
l,h=d.createElement("script");h.type="text/javascript";h.src=e+"?"+Date.now();a.util.addEventHandler(h,"load",g);a.util.addEventHandler(h,"readystatechange",g);b?f[f.length-1].parentNode.appendChild(h):f[0].parentNode.insertBefore(h,f[0])};a.util.extend=function(a,c){function b(){a.apply(this);c.apply(this,arguments)}c=c||function(){};b.prototype=a.prototype;return b};a.util.arrayRemove=function(a,c){for(var b=0;b<a.length;b++)a[b]===c&&a.splice(b,1)};a.util.elementPosition=function(a){var c=0,b=
0;if(a.offsetParent){do c+=a.offsetLeft,b+=a.offsetTop;while(a=a.offsetParent)}return{left:c,top:b}};a.util.browser=function(){var a=navigator.appName,c=navigator.userAgent,b,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);d&&null!=(b=c.match(/version\/([\.\d]+)/i))&&(d[2]=b[1]);d=d?[d[1],d[2]]:[a,navigator.appVersion,"-?"];return{name:d[0].toLowerCase(),version:d[1]}}();a.util.browser.os=function(){var a=navigator.platform.toLowerCase();return-1!=a.indexOf("win")?"windows":
-1!=a.indexOf("mac")?"mac":-1!=a.indexOf("iphone")||-1!=a.indexOf("ipod")||-1!=a.indexOf("ipad")?"iOS":-1!=a.indexOf("linux")?"linux":"unknown"}();a.util.browser.hasJava=navigator.javaEnabled();a.util.browser.agent=navigator.userAgent})(window,document,action);
(function(k,d,a){a.events={};a.events.READY="ready";a.events.LOAD="load";a.events.RESIZE="resize";a.events.ENTER_FRAME="enterframe";a.events.CLICK="click";a.events.MOUSE_MOVE="mousemove";a.events.MOUSE_DOWN="mousedown";a.events.MOUSE_UP="mouseup";a.events.MOUSE_WHEEL="mouse_wheel";a.events.KEY_DOWN="keydown";a.events.KEY_UP="keyup";a.events.TOUCH_START="touch_start";a.events.TOUCH_MOVE="touch_move";a.events.TOUCH_END="touch_end";a.events.DEVICE_MOTION="devicemotion";a.events.DEVICE_ORIENTATION="deviceorientation";
var e=[];a.events.bind=function(c,b,d){var f=function(){a.calc.ptCollisionRect(a.mouse.x,a.mouse.y,c)&&d(c)};a.addEventListener(b,f);e.push({obj:c,type:b,handler:d,realHandler:f})};a.events.unbind=function(c,b,d){for(var f=0;f<e.length;f++){var l=e[f];if(l.obj===c&&l.type===b&&l.handler===d){a.removeEventListener(b,l.realHandler);e.splice(f,1);break}}};a.addEventListener=function(c,b){a.util.addEventHandler(k,c,b)};a.removeEventListener=function(c,b){a.util.removeEventHandler(k,c,b)};a.dispatchEvent=
function(a,b){b=b||{};k.dispatchEvent(new CustomEvent(a,{detail:b}))};a.util.addEventHandler(k,"firefox"===a.util.browser.name?"DOMMouseScroll":"mousewheel",function(c){a.dispatchEvent(a.events.MOUSE_WHEEL,{delta:c.detail?-1*c.detail:c.wheelDelta/120})});k.TouchEvent&&(a.util.addEventHandler(d,"touchstart",function(c){a.dispatchEvent(a.events.TOUCH_START,c)}),a.util.addEventHandler(d,"touchmove",function(c){a.dispatchEvent(a.events.TOUCH_MOVE,c)}),a.util.addEventHandler(d,"touchend",function(c){a.dispatchEvent(a.events.TOUCH_END,
c)}))})(window,document,action);
(function(k,d){d.mouse={};d.mouse.x=0;d.mouse.y=0;d.addEventListener(d.events.MOUSE_MOVE,function(a){d.mouse.x=a.pageX-d.stageX;d.mouse.y=a.pageY-d.stageY});d.keyboard={};d.keyboard.ENTER=13;d.keyboard.SPACEBAR=32;d.keyboard.LEFT=37;d.keyboard.UP=38;d.keyboard.RIGHT=39;d.keyboard.DOWN=40;d.keyboard.A=65;d.keyboard.B=66;d.keyboard.C=67;d.keyboard.D=68;d.keyboard.E=69;d.keyboard.F=70;d.keyboard.G=71;d.keyboard.H=72;d.keyboard.I=73;d.keyboard.J=74;d.keyboard.K=75;d.keyboard.L=76;d.keyboard.M=77;d.keyboard.N=
78;d.keyboard.O=79;d.keyboard.P=80;d.keyboard.Q=81;d.keyboard.R=82;d.keyboard.S=83;d.keyboard.T=84;d.keyboard.U=85;d.keyboard.V=86;d.keyboard.W=87;d.keyboard.X=88;d.keyboard.Y=89;d.keyboard.Z=90})(window,action);
(function(k,d){d.Text=function(a,e,c){var b=this;this.displayed=!1;this.y=this.x=0;this.center={x:0,y:0};this.rotation=0;this.font=a||"16pt Arial";this.text=e||"";this.fill=c||"#000000";this.__defineGetter__("width",function(){d.stage.font=b.font;return d.stage.measureText(b.text).width});this.draw=function(a){a.save();a.translate(b.x,b.y);a.rotate(b.rotation*d.calc.DEG2RAD);a.fillStyle=b.fill;a.font=b.font;a.fillText(b.text,-b.center.x,-b.center.y);a.restore()}}})(window,action);
(function(k,d){d.Rectangle=function(a,e,c){var b=this;this.displayed=!1;this.y=this.x=0;this.width=a;this.height=e;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;this.fill=c||"#000000";this.draw=function(a){a.save();a.fillStyle=b.fill;a.translate(b.x,b.y);a.rotate(b.rotation*d.calc.DEG2RAD);a.fillRect(-b.center.x*b.scaleX,-b.center.y*b.scaleY,b.width*b.scaleX,b.height*b.scaleY);a.restore()}}})(window,action);
(function(k,d){d.Image=function(a){var e=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var c=a;this.__defineGetter__("src",function(){return c});this.__defineSetter__("src",function(a){c=a;b.src=c});var b=new Image;d.util.addEventHandler(b,"load",function(){e.width=b.width;e.height=b.height});c&&(b.src=c);this.load=function(a){d.util.addEventHandler(b,"load",a)};this.draw=function(a){a.save();a.translate(e.x,e.y);a.rotate(e.rotation*
d.calc.DEG2RAD);a.drawImage(b,-e.center.x*e.scaleX,-e.center.y*e.scaleY,e.width*e.scaleX,e.height*e.scaleY);a.restore()}}})(window,action);
(function(k,d){d.Animation=function(a,e,c){var b=this;this.displayed=!1;this.y=this.x=0;this.width=e;this.height=c;this.center={x:0,y:0};this.scaleY=this.scaleX=1;var g=this.rotation=0;this.__defineGetter__("numFrames",function(){return g});var f=0,l=a;this.__defineGetter__("src",function(){return l});this.__defineSetter__("src",function(a){l=a;h.src=l});var h=new Image;d.util.addEventHandler(h,"load",function(){g=Math.round(h.width/b.width);b.play(!0)});l&&(h.src=l);this.load=function(a){d.util.addEventHandler(h,
"load",a)};var k=!1;this.__defineGetter__("playing",function(){return k});var n,m=function(){f++;!n&&f>=g?b.stop():f%=g};this.play=function(a){n=a||!1;d.addEventListener(d.events.ENTER_FRAME,m);k=!0};this.stop=function(){d.removeEventListener(d.events.ENTER_FRAME,m);f=0;k=!1};this.draw=function(a){a.save();a.translate(b.x,b.y);a.rotate(b.rotation*d.calc.DEG2RAD);a.drawImage(h,f*b.width,0,b.width,b.height,-b.center.x*b.scaleX,-b.center.y*b.scaleY,b.width*b.scaleX,b.height*b.scaleY);a.restore()}}})(window,
action);(function(k,d){d.Sprite=function(){var a=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var d={},c;this.addState=function(a,c){d[a]=c};this.removeState=function(a){delete d[a]};this.showState=function(b){c=d[b];a.width=c.width;a.height=c.height};this.draw=function(b){c.x=a.x;c.y=a.y;c.center=a.center;c.scaleX=a.scaleX;c.scaleY=a.scaleY;c.rotation=a.rotation;c.draw(b)}}})(window,action);
