(function(f){f.action=new function(){var a=this,d=Date.now(),e=0,b,c,g,k,l,h,f,q,m=[],n=24,p;this.__defineGetter__("pageLoadTime",function(){return e});this.createLog=function(a,c){a=a||300;c=c||!1;b=document.createElement("div");b.style.position="absolute";c?(b.style.bottom="0px",b.style.left="0px",b.style.width="100%",b.style.height=String(a)+"px"):(b.style.top="0px",b.style.right="0px",b.style.width=String(a)+"px",b.style.height="100%");b.style.backgroundColor="#CCCCCC";b.style.fontFamily="Consolas, monaco, monospace";
b.style.fontSize="14px";b.style.overflowX="auto";b.style.overflowY="scroll";b.innerHTML="Action.JS Output<br><br>";document.body.appendChild(b)};this.createStage=function(b,d,e,m,n,p){k=b||0;l=d||0;h=e||800;f=m||600;q=n||"#FFFFFF";c=document.createElement("canvas");c.width=h;c.height=f;c.style.position="absolute";c.style.top=String(l)+"px";c.style.left=String(k)+"px";c.style.border=p||"1px solid #000000";g=c.getContext("2d");a.clearStage();document.body.appendChild(c)};this.setLog=function(a){b=document.getElementById(a);
b.style.fontFamily="Consolas, monaco, monospace";b.style.fontSize="14px";b.innerHTML="Action.JS Output<br><br>"};this.setStage=function(b,d){c=document.getElementById(b);k=a.util.elementPosition(c).left;l=a.util.elementPosition(c).top;h=c.width;f=c.height;g=c.getContext("2d");q=d||"#FFFFFF";a.clearStage()};this.__defineGetter__("canvas",function(){return c});this.__defineGetter__("stage",function(){return g});this.__defineGetter__("stageX",function(){return k});this.__defineGetter__("stageY",function(){return l});
this.__defineGetter__("stageWidth",function(){return h});this.__defineGetter__("stageHeight",function(){return f});this.__defineGetter__("numDisplayed",function(){return m.length});this.__defineGetter__("fps",function(){return n});this.__defineSetter__("fps",function(a){clearInterval(p);n=a;r()});var s=setInterval(function(){"complete"===document.readyState&&(e=Date.now()-d,a.main?a.main():console.log("Action.JS Warning: no function action.main() found"),clearInterval(s))},10),r=function(){p=setInterval(function(){a.dispatchEvent(a.events.ENTER_FRAME);
a.clearStage();a.drawAll()},Math.ceil(1E3/n))};this.kill=function(){clearInterval(p)};this.log=function(a){b.innerHTML+=">"+String(a)+"<br>";b.scrollTop=b.scrollHeight};this.title=function(a){document.title=a};this.clearStage=function(){g.fillStyle=q;g.fillRect(0,0,h,f)};this.drawAll=function(){for(var a=0;a<m.length;a++)m[a].draw(g)};this.display=function(c){a.undisplay(c);m.push(c);c.displayed=!0};this.undisplay=function(a){for(var c=0;c<m.length;c++)if(m[c]===a){m.splice(c,1);a.displayed=!1;break}}}})(window);
(function(f,a){a.calc={};a.calc.DEG2RAD=Math.PI/180;a.calc.RAD2DEG=180/Math.PI;a.calc.inRange=function(a,e,b){return e<=a&&a<=b};a.calc.distance=function(a,e,b,c){a=b-a;e=c-e;return Math.sqrt(a*a+e*e)};a.calc.rotate=function(a,e,b,c,g){var k=Math.sin(g);g=Math.cos(g);a-=b;e-=c;return{x:a*g-e*k+b,y:a*k+e*g+c}};a.calc.boundingBox=function(d){if(0===d.rotation%360)return{x:d.x-d.center.x*d.scaleX,y:d.y-d.center.y*d.scaleY,width:d.width*d.scaleX,height:d.height*d.scaleY};for(var e=[{x:0,y:0},{x:d.width*
d.scaleX,y:0},{x:d.width*d.scaleX,y:d.height*d.scaleY},{x:0,y:d.height*d.scaleY}],b=[],c,g=0;4>g;g++)c=e[g],b.push(a.calc.rotate(c.x,c.y,d.center.x,d.center.y,d.rotation*a.calc.DEG2RAD));for(var e=b[0].x,k=b[0].y,f=b[2].x,h=b[2].y,g=0;4>g;g++)c=b[g],c.x<e&&(e=c.x),c.x>f&&(f=c.x),c.y<k&&(k=c.y),c.y>h&&(h=c.y);b=d.x-d.center.x*d.scaleX;d=d.y-d.center.y*d.scaleY;e+=b;k+=d;return{x:e,y:k,width:f+b-e,height:h+d-k}};a.calc.ptCollisionRect=function(d,e,b){return b.displayed?(b=a.calc.boundingBox(b),a.calc.inRange(d,
b.x,b.x+b.width)&&a.calc.inRange(e,b.y,b.y+b.height)):!1};a.calc.ptCollisionCirc=function(d,e,b){if(b.displayed){b=a.calc.boundingBox(b);var c=b.width>b.height?b.width:b.height;return a.calc.distance(d,e,b.x+b.width/2,b.y+b.height/2)<=c}return!1};a.calc.collisionRect=function(d,e){if(d.displayed&&e.displayed){var b=a.calc.boundingBox(d),c=a.calc.boundingBox(e);return(a.calc.inRange(b.x,c.x,c.x+c.width)||a.calc.inRange(c.x,b.x,b.x+b.width))&&(a.calc.inRange(b.y,c.y,c.y+c.height)||a.calc.inRange(c.y,
b.y,b.y+b.height))}return!1};a.calc.collisionCirc=function(d,e){if(d.displayed&&e.displayed){var b=a.calc.boundingBox(d),c=a.calc.boundingBox(e),g=b.width>b.height?b.width:b.height,k=c.width>c.height?c.width:c.height;return a.calc.distance(b.x+b.width/2,b.y+b.height/2,c.x+c.width/2,c.y+c.height/2)<=g+k}return!1}})(window,action);
(function(f,a,d){d.util={};d.util.addEventHandler=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent&&a.attachEvent("on"+b,c)};d.util.removeEventHandler=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent&&a.detachEvent("on"+b,c)};d.util.include=function(e,b,c){function g(){f||h.readyState&&"complete"!==h.readyState||(f=!0,b(),d.util.removeEventHandler(h,"load",g),d.util.removeEventHandler(h,"readystatechange",g))}c=c||!1;b=b||function(){};var k=a.getElementsByTagName("script"),
f,h=a.createElement("script");h.type="text/javascript";h.src=e+"?"+Date.now();d.util.addEventHandler(h,"load",g);d.util.addEventHandler(h,"readystatechange",g);c?k[k.length-1].parentNode.appendChild(h):k[0].parentNode.insertBefore(h,k[0])};d.util.extend=function(a,b){function c(){a.apply(this);b.apply(this,arguments)}b=b||function(){};c.prototype=a.prototype;return c};d.util.arrayRemove=function(a,b){for(var c=0;c<a.length;c++)a[c]===b&&a.splice(c,1)};d.util.elementPosition=function(a){var b=0,c=
0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent)}return{left:b,top:c}};d.util.browser=function(){var a=navigator.appName,b=navigator.userAgent,c,d=b.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);d&&null!=(c=b.match(/version\/([\.\d]+)/i))&&(d[2]=c[1]);d=d?[d[1],d[2]]:[a,navigator.appVersion,"-?"];return{name:d[0].toLowerCase(),version:d[1]}}();d.util.browser.os=function(){var a=navigator.platform.toLowerCase();return-1!=a.indexOf("win")?"windows":
-1!=a.indexOf("mac")?"mac":-1!=a.indexOf("iphone")||-1!=a.indexOf("ipod")||-1!=a.indexOf("ipad")?"iOS":-1!=a.indexOf("linux")?"linux":"unknown"}();d.util.browser.hasJava=navigator.javaEnabled();d.util.browser.agent=navigator.userAgent})(window,document,action);
(function(f,a){a.events={};a.events.READY="ready";a.events.LOAD="load";a.events.ENTER_FRAME="enterframe";a.events.CLICK="click";a.events.MOUSE_MOVE="mousemove";a.events.MOUSE_DOWN="mousedown";a.events.MOUSE_UP="mouseup";a.events.MOUSE_WHEEL="mouse_wheel";a.events.KEY_DOWN="keydown";a.events.KEY_UP="keyup";a.events.click=function(d,e){a.addEventListener(a.events.CLICK,function(){a.calc.ptCollisionRect(a.mouse.x,a.mouse.y,d)&&e(d)})};a.events.hover=function(d,e){a.addEventListener(a.events.MOUSE_MOVE,
function(){a.calc.ptCollisionRect(a.mouse.x,a.mouse.y,d)&&e(d)})};a.addEventListener=function(d,e){a.util.addEventHandler(f,d,e)};a.removeEventListener=function(d,e){a.util.removeEventHandler(f,d,e)};a.dispatchEvent=function(a,e){e=e||{};f.dispatchEvent(new CustomEvent(a,{detail:e}))};a.addEventListener("firefox"===a.util.browser.name?"DOMMouseScroll":"mousewheel",function(d){a.dispatchEvent(a.events.MOUSE_WHEEL,{delta:d.detail?-1*d.detail:d.wheelDelta/120})})})(window,action);
(function(f,a){a.mouse={};a.mouse.x=0;a.mouse.y=0;a.addEventListener(a.events.MOUSE_MOVE,function(d){a.mouse.x=d.pageX-a.stageX;a.mouse.y=d.pageY-a.stageY});a.keyboard={};a.keyboard.ENTER=13;a.keyboard.SPACEBAR=32;a.keyboard.LEFT=37;a.keyboard.UP=38;a.keyboard.RIGHT=39;a.keyboard.DOWN=40;a.keyboard.A=65;a.keyboard.B=66;a.keyboard.C=67;a.keyboard.D=68;a.keyboard.E=69;a.keyboard.F=70;a.keyboard.G=71;a.keyboard.H=72;a.keyboard.I=73;a.keyboard.J=74;a.keyboard.K=75;a.keyboard.L=76;a.keyboard.M=77;a.keyboard.N=
78;a.keyboard.O=79;a.keyboard.P=80;a.keyboard.Q=81;a.keyboard.R=82;a.keyboard.S=83;a.keyboard.T=84;a.keyboard.U=85;a.keyboard.V=86;a.keyboard.W=87;a.keyboard.X=88;a.keyboard.Y=89;a.keyboard.Z=90})(window,action);
(function(f,a){a.Text=function(d,e,b){var c=this;this.displayed=!1;this.y=this.x=0;this.center={x:0,y:0};this.rotation=0;this.font=d||"16pt Arial";this.text=e||"";this.fill=b||"#000000";this.__defineGetter__("width",function(){a.stage.font=c.font;return a.stage.measureText(c.text).width});this.draw=function(b){b.save();b.translate(c.x,c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.fillStyle=c.fill;b.font=c.font;b.fillText(c.text,-c.center.x,-c.center.y);b.restore()}}})(window,action);
(function(f,a){a.Rectangle=function(d,e,b){var c=this;this.displayed=!1;this.y=this.x=0;this.width=d;this.height=e;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;this.fill=b||"#000000";this.draw=function(b){b.save();b.fillStyle=c.fill;b.translate(c.x,c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.fillRect(-c.center.x*c.scaleX,-c.center.y*c.scaleY,c.width*c.scaleX,c.height*c.scaleY);b.restore()}}})(window,action);
(function(f,a){a.Image=function(d){var e=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var b=d;this.__defineGetter__("src",function(){return b});this.__defineSetter__("src",function(a){b=a;c.src=b});var c=new Image;a.util.addEventHandler(c,"load",function(){e.width=c.width;e.height=c.height});b&&(c.src=b);this.load=function(b){a.util.addEventHandler(c,"load",b)};this.draw=function(b){b.save();b.translate(e.x,e.y);b.rotate(e.rotation*
a.calc.DEG2RAD);b.drawImage(c,-e.center.x*e.scaleX,-e.center.y*e.scaleY,e.width*e.scaleX,e.height*e.scaleY);b.restore()}}})(window,action);
(function(f,a){a.Animation=function(d,e,b){var c=this;this.displayed=!1;this.y=this.x=0;this.width=e;this.height=b;this.center={x:0,y:0};this.scaleY=this.scaleX=1;var g=this.rotation=0,f=0,l=d;this.__defineGetter__("src",function(){return l});this.__defineSetter__("src",function(a){l=a;h.src=l});var h=new Image;a.util.addEventHandler(h,"load",function(){g=Math.round(h.width/c.width)});l&&(h.src=l);a.addEventListener(a.events.ENTER_FRAME,function(){f++;f%=g});this.draw=function(b){b.save();b.translate(c.x,
c.y);b.rotate(c.rotation*a.calc.DEG2RAD);b.drawImage(h,f*c.width,0,c.width,c.height,-c.center.x*c.scaleX,-c.center.y*c.scaleY,c.width*c.scaleX,c.height*c.scaleY);b.restore()}}})(window,action);
(function(f,a){a.Sprite=function(){var a=this;this.displayed=!1;this.height=this.width=this.y=this.x=0;this.center={x:0,y:0};this.scaleY=this.scaleX=1;this.rotation=0;var e={},b;this.addState=function(a,b){e[a]=b};this.removeState=function(a){delete e[a]};this.showState=function(c){b=e[c];a.width=b.width;a.height=b.height};this.draw=function(c){b.x=a.x;b.y=a.y;b.center=a.center;b.scaleX=a.scaleX;b.scaleY=a.scaleY;b.rotation=a.rotation;b.draw(c)}}})(window,action);
